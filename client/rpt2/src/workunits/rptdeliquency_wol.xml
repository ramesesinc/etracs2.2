<workunit>
    <invokers>
        <invoker type="rptdelinquency:wol" action="init" caption="Warrant of Levy" target="window"/>
        <invoker type="rptdelinquency_open:wol" action="open" caption="Warrant of Levy" target="window"/>
        
        <invoker type="formActions" action="_close" caption="Cancel"  mnemonic="c" immediate="true" icon="images/cancel.png" />        
        <invoker type="formActions" action="save" caption="Save"  mnemonic="s"  icon="images/save.png" visibleWhen="#{mode=='init'}" /> 
        <invoker type="formActions" action="previewWarrant" caption="Preview Warrant of Levy" icon="images/doc-view.png" mnemonic="w"  visibleWhen="#{mode=='saved'}" /> 
        <invoker type="formActions" action="previewNotice" caption="Preview Notice of Levy"  icon="images/doc-view.png" mnemonic="n"   visibleWhen="#{mode=='saved'}" /> 
          
         <invoker type="previewActions"  action="back" caption="Back" icon="images/back.png" immediate="true" />
    </invokers>
    <code>
<![CDATA[

import com.rameses.rcp.common.*;
import com.rameses.rcp.annotations.*;
import com.rameses.osiris2.client.*;
import com.rameses.osiris2.reports.*;
import etracs2.groovy.CommonUtil

public class RPTDelinquencyWOL
{
    
    @Service('RPTDelinquencyService')
    def svc;
    
    @Service( 'ReportParameterService')
    def paramSvc
    
    @Service( 'DateService')
    def dtSvc
    
    def entity; 
    def mode
    def objid;
    def document
    
    public void init() {
        mode = 'init';
        entity = svc.open(objid)
        entity.doctype = document.code
        entity.doctypedesc = document.description
        entity.parentid = entity.objid
    }
    
    public def open() {
        mode ='saved'
        entity = svc.open(entity.objid)
        return "default";
    }
    
    public void save() {
        entity = svc.supersedeDoc( entity )
        mode = 'saved';
        MsgBox.alert("Successfully saved.    ")
    }
    
    def reportname = 'demandletters/warrantoflevy'
    
    def previewWarrant() {
        reportname = 'demandletters/warrantoflevy'
        report.viewReport()
        return "preview";
    }
    
    def previewNotice() {
        reportname = 'demandletters/noticeoflevy'
        report.viewReport()
        return "preview";
    }
    
    def back() {
        return "default";
    }
    
    
    def report = [
        getReportName : { return reportname }, 
        getReportData : { return entity },
        getParameters : {
            def params = paramSvc.getStandardParameter( OsirisContext.env.USERNAME )
            params.CURRDAY = formatday( );
            params.CURRYEAR = dtSvc.getServerYear() + ""
            params.CURRMONTH = new java.text.SimpleDateFormat("MMMMM").format( params.PRINTDATE ); 
            return params 
        }
    ]  as ServerReportModel
    
    
    def formatday() {
        def day = dtSvc.getServerDay()
        return  day + "" + getDaySuffix(day)
    }
    
    def getDaySuffix( day ) {
        day = day+"";
        
        if( day.matches('1|21|31')) return 'st'
        else if( day.matches('2|22')) return 'nd'
        else if( day.matches('3|23')) return 'rd'
        else return 'th'
    } 
    
}

    
]]>
    </code>
    <pages>
        <page template="etracs2.rpt.report.rptdelinquency.DemandLetterPage"/>
        <page name="preview" template="etracs2.common.PreviewPage" />
    </pages>
</workunit>